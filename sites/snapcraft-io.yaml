name: snapcraft-io
domain: snapcraft.io

container:
  image: prod-comms.docker-registry.canonical.com/snapcraft.io

useSquid: true

envSecrets:
  - name: SENTRY_DSN
    value: https://1e82fd54e08142c9978f623cb746b965@sentry.is.canonical.com//3

  - name: ENVIRONMENT
    configMapKeyRef:
      key: environment
      name: environment

  - name: SECRET_KEY
    secretKeyRef:
      key: secret_key
      name: snapcraft-io

  - name: MARKETO_CLIENT_ID
    secretKeyRef:
      key: marketo_client_id
      name: snapcraft-io

  - name: MARKETO_CLIENT_SECRET
    secretKeyRef:
      key: marketo_client_secret
      name: snapcraft-io

  - name: SEARCH_API_KEY
    secretKeyRef:
      key: google-custom-search-key
      name: google-api

memory: 1Gi

# Overrides for production
production:
  extraHosts:
    - host:
      - docs.snapcraft.io
      tlsSecret: docs-snapcraft-io-tls

  nginxConfig:  |
    if ($host = 'docs.snapcraft.io' ) {
      rewrite ^ https://snapcraft.io/docs$request_uri? permanent;
    }
    if ($host != 'snapcraft.io' ) {
      rewrite ^ https://snapcraft.io$request_uri? permanent;
    }
    more_set_headers "Link: <https://assets.ubuntu.com>; rel=preconnect; crossorigin, <https://assets.ubuntu.com>; rel=preconnect, <https://res.cloudinary.com>; rel=preconnect, <https://dashboard.snapcraft.io>; rel=preconnect";

# Overrides for staging
staging:
  name: staging-snapcraft-io
  domain: staging.snapcraft.io
  wwwPrefixHost: false

  extraHosts:
    - host:
      - docs.staging.snapcraft.io
      tlsSecret: docs-staging-snapcraft-io-tls

  nginxConfig:  |
    if ($host = 'docs.staging.snapcraft.io' ) {
      rewrite ^ https://staging.snapcraft.io/docs$request_uri? permanent;
    }
    more_set_headers "X-Robots-Tag: noindex";
    more_set_headers "Link: <https://assets.ubuntu.com>; rel=preconnect; crossorigin, <https://assets.ubuntu.com>; rel=preconnect, <https://res.cloudinary.com>; rel=preconnect, <https://dashboard.snapcraft.io>; rel=preconnect";
