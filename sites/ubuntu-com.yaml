name: ubuntu-com
domain: ubuntu.com

container:
  image: prod-comms.docker-registry.canonical.com/ubuntu.com

useSquid: true

envSecrets:
  - name: SEARCH_API_KEY
    secretKeyRef:
      key: google-custom-search-key
      name: google-api

  - name: SENTRY_DSN
    value: https://0293bb7fc3104e56bafd2422e155790c@sentry.is.canonical.com//13

memory: 512Mi

includeRootPath: false
extraPaths:
  - path: /blog
    serviceName: ubuntu-com-blog
  - path: /
    serviceName: ubuntu-com

# Overrides for production
production:
  extraHosts:
    - host:
      - ubuntu.net
      noTls: true

    - host:
      - blog.ubuntu.com
      tlsSecret: blog-ubuntu-com-tls

    - host:
      - insights.ubuntu.com
      tlsSecret: insights-ubuntu-com-tls

    - host:
      - www.ubuntu.net
      - ubunut.com
      - www.ubunut.com
      - ubuntulinux.org
      - www.ubuntulinux.org
      noTls: true

  nginxSslRedirect: false
  nginxConfig: |
    if ($host = 'blog.ubuntu.com' ) {
      rewrite ^ https://ubuntu.com/blog$request_uri? permanent;
    }
    if ($host = 'insights.ubuntu.com' ) {
      rewrite ^ https://ubuntu.com/blog$request_uri? permanent;
    }
    if ($host != 'ubuntu.com' ) {
      rewrite ^ https://ubuntu.com$request_uri? permanent;
    }
    more_set_headers "Link: <https://assets.ubuntu.com>; rel=preconnect; crossorigin, <https://assets.ubuntu.com>; rel=preconnect, <https://res.cloudinary.com>; rel=preconnect";

# Overrides for staging
staging:
  nginxConfig: |
    if ($host != 'staging.ubuntu.com' ) {
      rewrite ^ https://staging.ubuntu.com$request_uri? permanent;
    }
    more_set_headers "X-Robots-Tag: noindex";
    more_set_headers "Link: <https://assets.ubuntu.com>; rel=preconnect; crossorigin, <https://assets.ubuntu.com>; rel=preconnect, <https://res.cloudinary.com>; rel=preconnect";
